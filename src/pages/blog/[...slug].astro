---
import { Image } from 'astro:assets'
import { type CollectionEntry, getCollection, render } from 'astro:content'
import calcReadingTime from 'reading-time'
import photo from '../../assets/images/photo.jpg'
import Layout from '../../layouts/Layout.astro'

export async function getStaticPaths() {
  const posts = await getCollection('blog')
  return posts.map(post => ({
    params: { slug: post.id },
    props: post
  }))
}
type Props = CollectionEntry<'blog'>

const post = Astro.props
const { Content } = await render(post)

const { title, publishedAt, thumbnail, thumbnailAlt, thumbnailSource, isMultiLang, lang } = post.data
const publishDate = new Date(publishedAt).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
})
const { text: readingTime } = calcReadingTime(post.body || '')
const { pathname } = Astro.url
const githubFileUrl = `https://github.com/anasalqoyyum/superior-personal-site/edit/master/src/content{pathname.replace(//$/, '')}.md`

const buildUrl = () => {
  switch (lang) {
    case 'ID':
      return pathname.replace('id', 'en')
    case 'EN':
      return pathname.replace('en', 'id')
    default:
      return pathname
  }
}
const altLang = () => {
  switch (lang) {
    case 'ID':
      return 'English'
    case 'EN':
      return 'Bahasa Indonesia'
    default:
      return 'English'
  }
}
---

<Layout title={title}>
  <article class="my-6" item-prop="blogPost" item-scope item-type="https://schema.org/BlogPosting">
    <div class="mb-6 flex flex-col justify-between sm:flex-row">
      <h1 class="w-3/4 text-4xl font-bold tracking-tight md:w-[85%] md:text-5xl" item-prop="name headline">
        {title}
      </h1>
      {
        isMultiLang && (
          <a
            class="mt-6 text-sm text-slate-500 underline transition-colors duration-200 sm:w-1/4 sm:self-center sm:text-end dark:text-slate-300"
            href={buildUrl()}
          >
            Read in {altLang()}?
          </a>
        )
      }
    </div>
    <header class="mb-8 flex items-center sm:mb-10">
      <figure
        class="mr-4 h-8 w-8 flex-shrink-0 overflow-hidden rounded-full bg-slate-200 ring-1 ring-slate-200 sm:h-6 sm:w-6 dark:ring-slate-800"
      >
        <Image src={photo} height={48} width={48} alt="Anas Alqoyyum" />
      </figure>
      <div class="flex flex-col text-sm sm:w-full sm:flex-row sm:justify-between">
        <div class="text-slate-600 dark:text-slate-400">
          <span item-prop="author" item-scope item-type="https://schema.org/Person">
            <span item-prop="name">Anas Alqoyyum</span>
          </span>
          at
          <time item-prop="datePublished" date-time={publishedAt}>
            {publishDate}
          </time>
        </div>
        <div class="text-slate-500">
          {readingTime}
        </div>
      </div>
    </header>
    <section class="prose dark:prose-dark prose-invert mx-auto mb-6 w-full max-w-none font-sans" item-prop="articleBody">
      <img src={thumbnail} alt={thumbnailAlt} class="mx-auto block max-w-[50%]" />
      <div class="text-center text-xs break-all text-slate-500">
        {thumbnailSource}
      </div>
      <Content />
    </section>
    <footer class="mx-auto flex w-full justify-between text-slate-600 dark:text-slate-400">
      <div class="text-sm">
        <a class="inline-block border-b border-transparent transition hover:border-slate-600" href={githubFileUrl}>Edit on GitHub</a>
      </div>
    </footer>
  </article>
</Layout>
